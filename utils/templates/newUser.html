{% extends "base.html" %}

{% block baseHead %}



<!-- add SEO -->
<meta property="og:type" content="website">   
<meta property="twitter:site" content="@Blogifyr">
<meta property="og:image" content="/static/img/banner.png">
<meta name="twitter:image" content="/static/img/banner.png">
<link rel="stylesheet" href="/static/css/newUser.css">
<meta name="keywords" content="{{ keywords or '' }}">

{% endblock %}


{% block baseBody %}
<!-- if login... -->
<nav>
    <div class="nav-left-container">
        <a href="/">
            <svg viewBox="0 0 410 109" style="height: 100%;" preserveAspectRatio="xMidYMid meet" class="css-8aabad"
                id="dgegagha">
                <defs id="SvgjsDefs2161">
                    <linearGradient id="SvgjsLinearGradient2168">
                        <stop id="SvgjsStop2169" stop-color="#006838" offset="0"></stop>
                        <stop id="SvgjsStop2170" stop-color="#96cf24" offset="1"></stop>
                    </linearGradient>
                </defs>
                <g id="SvgjsG2162" featurekey="symbolContainer" transform="matrix(1,0,0,1,0,0)" fill="#111">
                    <rect width="110" height="109"></rect>
                </g>
                <g id="SvgjsG2163" featurekey="monogramFeature-0"
                    transform="matrix(1.8430753250050795,0,0,1.8430753250050795,15.466031993639358,-17.069509952010947)"
                    fill="currentColor">
                    <path
                        d="M29.28 37.08 c6.9 0.96 11.16 5.16 11.16 10.92 c0 7.08 -6.24 12 -20.1 12 l-16.44 0 c-0.84 0 -1.44 -0.42 -1.44 -1.14 l0 -0.24 c0 -1.68 2.4 -2.4 2.4 -5.16 l0 -29.52 c0 -2.76 -2.4 -3.48 -2.4 -5.16 l0 -0.24 c0 -0.72 0.6 -1.14 1.44 -1.14 l16.62 0 c10.8 0 15.72 4.8 15.72 10.8 c0 4.5 -2.76 7.8 -6.96 8.88 z M15.66 24.72 l0 7.56 c0 1.98 1.32 3.12 3.24 3.12 l3 0 c3.06 0 5.04 -2.22 5.04 -5.64 c0 -5.16 -2.7 -8.16 -6.78 -8.16 l-1.68 0 c-1.56 0 -2.82 0.72 -2.82 3.12 z M23.04 55.8 c3.84 0 6 -2.52 6 -6.24 c0 -4.44 -3.66 -9.96 -10.86 -9.96 l-2.52 0 l0 11.1 c0 2.88 1.74 5.1 4.5 5.1 l2.88 0 z">
                    </path>
                </g>
                <g id="SvgjsG2164" featurekey="nameFeature-0"
                    transform="matrix(2.0408161449540345,0,0,2.0408161449540345,125.1020420306199,-6.102038138072011)"
                    fill="#000">
                    <path
                        d="M15.88 24.6 c3.68 0.84 6.08 3.88 6.08 7.4 c0 4.92 -3.2 8 -10.12 8 l-9.44 0 l0 -28 l9.56 0 c5.48 0 8.2 3.12 8.2 6.76 c0 2.68 -1.52 4.84 -4.28 5.84 z M11.72 14.96 l-6 0 l0 8.56 l6 0 c3.2 0 5.16 -1.76 5.16 -4.32 c0 -2.64 -1.84 -4.24 -5.16 -4.24 z M11.72 37.04 c4.8 0 6.92 -1.96 6.92 -5.32 c0 -2.92 -2.12 -5.44 -6.72 -5.44 l-6.2 0 l0 10.76 l6 0 z M28.919999999999998 11.719999999999999 l0 28.28 l-3.28 0 l0 -28.28 l3.28 0 z M43.239999999999995 18.84 c4.72 0 10.68 3.6 10.68 10.8 s-5.96 10.76 -10.68 10.76 s-10.64 -3.56 -10.64 -10.76 s5.92 -10.8 10.64 -10.8 z M43.239999999999995 21.76 c-3.36 0 -7.44 2.6 -7.44 7.88 c0 5.24 4.08 7.84 7.44 7.84 c3.4 0 7.48 -2.6 7.48 -7.84 c0 -5.28 -4.08 -7.88 -7.48 -7.88 z M74.64 19.2 l3.28 0 l0 20.8 c0 6.28 -5.52 8.24 -9.52 8.24 c-3.2 0 -5.24 -0.84 -6.24 -1.56 l0 -2.8 c1 0.72 3.04 1.56 6.24 1.56 c3.6 0 6.24 -1.96 6.24 -5.44 l0 -4 c-0.96 2.4 -3.8 4.4 -7.48 4.4 c-4.72 0 -10.44 -3.56 -10.44 -10.8 c0 -7.16 5.72 -10.76 10.44 -10.76 c3.68 0 6.52 2.04 7.48 4.28 l0 -3.92 z M67.52 37.48 c3.56 0 7.28 -2.52 7.28 -7.88 c0 -5.32 -3.72 -7.84 -7.28 -7.84 c-3.52 0 -7.6 2.6 -7.6 7.84 c0 5.28 4.08 7.88 7.6 7.88 z M85.76 11.719999999999999 l0 2.92 l-3.28 0 l0 -2.92 l3.28 0 z M85.76 19.2 l0 20.8 l-3.28 0 l0 -20.8 l3.28 0 z M97.68 14.079999999999998 c-2.2 0 -3.28 1.08 -3.28 3.64 l0 1.48 l5.88 0 l0 2.76 l-5.88 0 l0 18.04 l-3.28 0 l0 -18.04 l-2.28 0 l0 -2.76 l2.28 0 l0 -1.48 c0 -5.48 3.64 -6.4 6.28 -6.4 c1.72 0 3.32 0.48 4.52 1.24 l-1.2 2.28 c-0.92 -0.44 -1.84 -0.76 -3.04 -0.76 z M121.04 19.16 l3.28 0 l-12.64 28.44 l-3.28 0 l3.72 -8.28 l-9 -20.16 l3.28 0 l7.32 16.56 z M138.6 18.88 c0.36 0 0.68 0 1 0.08 l0 3.08 c-0.32 -0.08 -0.68 -0.08 -0.96 -0.08 c-3.96 0 -7.2 2.84 -7.76 7.52 l0 10.52 l-3.28 0 l0 -20.8 l3.28 0 l0 5.48 c0.76 -3.08 3.6 -5.8 7.72 -5.8 z">
                    </path>
                </g>
            </svg>
        </a>

    </div>
    <div class="nav-right-container">
        <a href="/about">Our story</a>
        <a href="https://github.com/thefcraft/blog" class="dnon">Write</a>
        <div class="btn" onclick="window.location.href = '#newsletter'">Get started</div>
    </div>
</nav>
{% if not tag %}
<div class="hero">
    <aside class="left">
        <h2>
            Embrace Knowledge.
        </h2>
        <h3>
            Uncover inspiring narratives, innovative ideas, and profound insights across all subjects.
        </h3>
        <div class="btn" onclick="window.location.href = '#newsletter'">Start reading</div>
    </aside>
    <aside class="right right-logo-div">
        <div class="right-logo"> 
            <h1>Blogifyr</h1>
            <h1>Blogifyr</h1>
        </div>
    </aside>
</div>
{% endif %}

<div class="trending">
    <div class="head">
        {% if not tag %}
        <svg width="28" height="29" viewBox="0 0 28 29" fill="none" class="ji ah">
            <path fill="#fff" d="M0 .8h28v28H0z"></path>
            <g opacity="0.8" clip-path="url(#trending_svg__clip0)">
                <path fill="#fff" d="M4 4.8h20v20H4z"></path>
                <circle cx="14" cy="14.79" r="9.5" stroke="#000"></circle>
                <path d="M5.46 18.36l4.47-4.48M9.97 13.87l3.67 3.66M13.67 17.53l5.1-5.09M16.62 11.6h3M19.62 11.6v3"
                    stroke="#000" stroke-linecap="round"></path>
            </g>
            <defs>
                <clipPath id="trending_svg__clip0">
                    <path fill="#fff" transform="translate(4 4.8)" d="M0 0h20v20H0z"></path>
                </clipPath>
            </defs>
        </svg>
        <h2>Trending on Blogifyr</h2>    
        {% else %}
        <div style="height: 29px;"></div>
        {% endif %}
        
    </div>
   <div class="container" id="trendingPosts">
        {% for post in trending %}
        <div class="item">
            <aside>
                <span class="idx">{{ post.idx }}</span>
            </aside>
            <aside>
                <div class="img">
                    <img alt="{{ post.author }}" src="/static/userPNG/{{ post.author_img if post.author_img else 'None.png' }}" width="20" height="20" loading="lazy">
                    <a href="{{ post.author_url }}">
                        <h4>{{ post.author }}</h4>
                    </a>
                </div>

                <a href="{{ post.url }}">
                    <div>
                        <h2 class="overflow-ellipsis">{{ post.title }}</h2>
                    </div>
                    <span>{{ post.date }} · {{ post.length }} read</span>
                </a>
            </aside>
        </div>
        {% endfor %}
    </div>
</div>

<div class="root">
    <aside>
        <div class="container" id="postsContainer">
            {% for post in home_posts %}
            <div class="item">
                <aside style="width: -webkit-fill-available;">
                    <div class="img">
                        <img alt="{{ post.author }}" src="/static/userPNG/{{ post.author_img if post.author_img else 'None.png' }}" width="20" height="20" loading="lazy">
                        <a href="{{ post.author_url }}">
                            <h4>{{ post.author }}</h4>
                        </a>
                    </div>
                    <a href="{{ post.url }}">
                        <div class="title" id="title_hover">
                            <h2 class="overflow-ellipsis">{{ post.title }}</h2>
                            <h3 class="overflow-ellipsis-3">{{ post.subtitle }}</h3>
                        </div>
                    </a>
                    <div class="meta">
                        <div>
                            <!-- <a style="background-color: #f2f2f2; padding: 3px 8px; border-radius: 99em; margin-right: 8px;"  
                                onmouseover="this.style.backgroundColor='#e7e7e7'"
                                onmouseout="this.style.backgroundColor='#f2f2f2'"
                                href="{{ post.tag_url }}">{{ post.tag }}</a>     -->
                            <a href="{{ post.url }}">
                                <span>{{ post.date }} · {{ post.length }} read</span>
                            </a>
                        </div>
                    </div>

                </aside>
                <aside style="display: flex;align-items: center;">
                    {% if post.img %}
                    <a href="{{ post.url }}">
                        <img alt="{{ post.title }}" class="blog-img" src="{{ post.img }}" width="200" height="134"
                            loading="lazy">
                    </a>
                    {% else %}
                    <div class="blog-img"></div>
                    {% endif %}

                </aside>
            </div>
            {% endfor %}
        </div>
        <div class="loadMoreBtn">
            <button onclick="loadMoreBtn(this)">Load More</button>
        </div>
    </aside>
    <aside class="right" id="right-fixed-container">
        <div id="right-fixed" style="max-width: 400px;">
            <h2>Discover more of what matters to you</h2>
            <div class="tags" id="trendingTags">
                {% for tg in trendingTags %}
                    {% if tag and tg.name == tag.name %}
                    <a href="" class="active">{{ tg.name }}</a>    
                    {% else %}
                    <a href="/tag/{{ tg.url }}">{{ tg.name }}</a>    
                    {% endif %}
                {% endfor %}
            </div>
            <a href="/tag" class="more">See more topics</a>
            <div class="side-footer">
                <a href="/about">About</a>
                <a href="https://github.com/thefcraft/blog">Blog</a>
                <a href="/privacy">Privacy</a>
                <a href="/terms">Terms</a>
                <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API">Text to speech</a>
                <a href="https://github.com/thefcraft/blog/graphs/contributors">Teams</a>
            </div>
        </div>
    </aside>
    
</div>

<footer>
    <div class="newsletter" id="newsletter">
        <h2>Sign up for my newsletter</h2>
        <p>Get notified when I post a new article. Unsubscribe at any time, and I promise not to send any spam :)</p>
        <form action="https://formspree.io/f/mbjnelqe" method="POST">
        <input type="email" id="email" name="EMAIL" autocomplete="email" required="" placeholder="Your email">
        <button style="padding: 0px;" type="submit">
            <div style="display:flex; align-items: center; padding: 4px 8px;">
            Follow
            <svg width="38" height="38" viewBox="0 0 38 38" fill="none" style="stroke: rgb(255, 255, 255);width: 36px;height: 36px;"><rect x="26.25" y="9.25" width="0.5" height="6.5" rx="0.25"></rect><rect x="29.75" y="12.25" width="0.5" height="6.5" rx="0.25" transform="rotate(90 29.75 12.25)"></rect><path d="M19.5 12.5h-7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-5"></path><path d="M11.5 14.5L19 20l4-3"></path></svg>
            </div>
        </button>
        </form>
    </div>
</footer>

<script>
    const nav = document.getElementsByTagName("nav")[0];
    const hero = document.getElementsByClassName("hero")[0];
    const rightFixed = document.getElementById("right-fixed");
    const rightFixedContainer = document.getElementById("right-fixed-container");

    // Sample array of blog objects (titles are assumed to be unique for simplicity)
    let allblogs = [    
    ];

    // Function to search for blogs based on title
    function searchBlogs(query) {
        query = query.toLowerCase(); // Convert query to lowercase for case-insensitive search

        // Filter blogs array based on the query
        const results = allblogs.filter(blog =>
            blog.title.toLowerCase().includes(query)
        );

        return results;
    }
    // searchBlogs('React');

    function getRandomElements(array, numElements) {
        // Sort the array randomly
        array.sort(() => Math.random() - 0.5);
    
        // Return a slice of the first numElements elements
        return array.slice(0, numElements);
    }

    const postsContainer = document.getElementById("postsContainer");
    const trendingPosts = document.getElementById("trendingPosts");
    const trendingTags = document.getElementById("trendingTags");
    postsContainer.innerHTML = '';
    let posts_chunk_idx = 0;
    let posts_chunk = [];
    fetch('/api/posts.json').then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
            return response.json();
        }).then(data => {
            posts_chunk = getRandomElements(data.posts_chunk, data.posts_chunk.length);
        })
        .catch(error => {
            console.error('Error:', error);
    });

    
    function loadMoreBtn(element){
        console.log("Loading more...");
        posts_chunk_idx ++;
        if (posts_chunk.length == posts_chunk_idx) posts_chunk_idx = 0;
        // Make a GET request
        fetch(`/api/${posts_chunk[posts_chunk_idx]}`).then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
                return response.json();
            })
            .then(data => {
                trendingPosts.innerHTML = '';
                allblogs = data.posts;
                // console.log(data.posts);
                let blogs = getRandomElements(data.posts, data.posts.length);
                blogs.forEach(post => {
                    let ifelseblock = '';
                    if (post.img) {
                        ifelseblock = `<a href="${ post.url }">
                        <img alt="${ post.title }" class="blog-img" src="${ post.img }" width="200" height="134"
                            loading="lazy">
                    </a>`;
                    }else ifelseblock = '<div class="blog-img"></div>';

                    postsContainer.innerHTML += `
                    <div class="item">
                <aside style="width: -webkit-fill-available;">
                    <div class="img">
                        <img alt="${ post.author }" src="/static/userPNG/${ post.author_img?post.author_img:'None.png' }" width="20" height="20" loading="lazy">
                        <a href="${ post.author_url }">
                            <h4>${ post.author }</h4>
                        </a>
                    </div>
                    <a href="${ post.url }">
                        <div class="title" id="title_hover">
                            <h2 class="overflow-ellipsis">${ post.title }</h2>
                            <h3 class="overflow-ellipsis-3">${ post.subtitle }</h3>
                        </div>
                    </a>
                    <div class="meta">
                        <div>
                            <!-- <a style="background-color: #f2f2f2; padding: 3px 8px; border-radius: 99em; margin-right: 8px;"  
                                onmouseover="this.style.backgroundColor='#e7e7e7'"
                                onmouseout="this.style.backgroundColor='#f2f2f2'"
                                href="${ post.tag_url }">${ post.tag }</a>     -->
                            <a href="${ post.url }">
                                <span>${ post.date } · ${ post.length } read</span>
                            </a>
                        </div>
                    </div>
                </aside>
                <aside style="display: flex;align-items: center;">
                    ${ ifelseblock }
                </aside>
            </div>`;
                    });

            })  
            .catch(error => {
                console.error('Error:', error);
        });
    }
       
        
    fetch('/api/tags.json').then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
            return response.json();
        })
        .then(data => {
            trendingTags.innerHTML = '';
            // console.log(data.posts);
            let tags = getRandomElements(data.tags, 9);
            tags.forEach(tag => {
                trendingTags.innerHTML += `<a href="/tag/${ tag.url} ">${ tag.name }</a>`;
            });
        })
        .catch(error => {
            console.error('Error:', error);
    });

    

    // Make a GET request
    fetch('/api/posts_1.json').then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
            return response.json();
        })
        .then(data => {
            trendingPosts.innerHTML = '';
            allblogs = data.posts;
            // console.log(data.posts);
            let blogs = getRandomElements(data.posts, 15);
            blogs.forEach(post => {
                let ifelseblock = '';
                if (post.img) {
                    ifelseblock = `<a href="${ post.url }">
                    <img alt="${ post.title }" class="blog-img" src="${ post.img }" width="200" height="134"
                        loading="lazy">
                </a>`;
                }else ifelseblock = '<div class="blog-img"></div>';
                
                postsContainer.innerHTML += `
                <div class="item">
            <aside style="width: -webkit-fill-available;">
                <div class="img">
                    <img alt="${ post.author }" src="/static/userPNG/${ post.author_img?post.author_img:'None.png' }" width="20" height="20" loading="lazy">
                    <a href="${ post.author_url }">
                        <h4>${ post.author }</h4>
                    </a>
                </div>
                <a href="${ post.url }">
                    <div class="title" id="title_hover">
                        <h2 class="overflow-ellipsis">${ post.title }</h2>
                        <h3 class="overflow-ellipsis-3">${ post.subtitle }</h3>
                    </div>
                </a>
                <div class="meta">
                    <div>
                        <!-- <a style="background-color: #f2f2f2; padding: 3px 8px; border-radius: 99em; margin-right: 8px;"  
                            onmouseover="this.style.backgroundColor='#e7e7e7'"
                            onmouseout="this.style.backgroundColor='#f2f2f2'"
                            href="${ post.tag_url }">${ post.tag }</a>     -->
                        <a href="${ post.url }">
                            <span>${ post.date } · ${ post.length } read</span>
                        </a>
                    </div>
                </div>
            </aside>
            <aside style="display: flex;align-items: center;">
                ${ ifelseblock }
            </aside>
        </div>`;
                });
                
            let trendingblogs = getRandomElements(data.posts, 3);

            trendingblogs.forEach((post, idx) => {
                trendingPosts.innerHTML += `<div class="item">
                            <aside>
                                <span class="idx">0${ idx+1 }</span>
                            </aside>
                            <aside>
                                <div class="img">
                                    <img alt="${ post.author }" src="/static/userPNG/${ post.author_img?post.author_img:'None.png' }" width="20" height="20" loading="lazy">
                                    <a href="${ post.author_url }">
                                        <h4>${ post.author }</h4>
                                    </a>
                                </div>
                
                                <a href="${ post.url }">
                                    <div>
                                        <h2 class="overflow-ellipsis">${ post.title }</h2>
                                    </div>
                                    <span>${ post.date } · ${ post.length } read</span>
                                </a>
                            </aside>
                        </div>`;
            });
        
        })
        .catch(error => {
            console.error('Error:', error);
    });
    
    

    onload = (e) => {
        // setTimeout(()=>{
        //     window.scrollTo({ top: 0, behavior: 'smooth' }); // TODO auto scroll to top
        // }, 100);

        if (document.documentElement.scrollTop > rightFixedContainer.offsetTop - nav.scrollHeight - 56) {
            rightFixed.style.position = "fixed";
            rightFixed.style.top = (nav.scrollHeight + 56) + "px";
        }
    }
    let loading = 0;

    onscroll = (e) => {
        if (document.documentElement.scrollTop > rightFixedContainer.offsetTop - nav.scrollHeight - 56) {
            rightFixed.style.position = "fixed";
            rightFixed.style.top = (nav.scrollHeight + 56) + "px";
        } else {
            rightFixed.style.position = "unset";
        }
        if (document.documentElement.scrollTop > (hero.scrollHeight - nav.scrollHeight)) {
            // console.log("green");
            nav.classList.add('nav-transparent');
        } else {
            // console.log("yellow");
            nav.classList.remove('nav-transparent');
        }
    }
</script>
{% endblock %}